# Standard data ingestion template
name: standard_ingestion
version: "1.0"
description: "Template for standardized data ingestion with quality checks"

parameters:
  - name: source_path
    type: string
    required: true
    description: "Path to source data files"
  
  - name: table_name
    type: string
    required: true
    description: "Target table name"
  
  - name: file_format
    type: string
    default: "json"
    description: "Source file format (json, parquet, csv)"

actions:
  - name: load_{table_name}_raw
    type: load
    source:
      type: cloudfiles
      path: "{source_path}"
      format: "{file_format}"
    target: v_{table_name}_raw
    description: "Load raw {table_name} data"
  
  - name: validate_{table_name}
    type: transform
    transform_type: data_quality
    source: v_{table_name}_raw
    target: v_{table_name}_validated
    expectations_file: "expectations/{table_name}_quality.yaml"
    description: "Apply quality checks to {table_name}"
  
  - name: write_{table_name}_bronze
    type: write
    source: v_{table_name}_validated
    write_target:
      type: streaming_table
      database: "{catalog}.{bronze_schema}"
      table: "{table_name}"
    description: "Write {table_name} to bronze layer"
